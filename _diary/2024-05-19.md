#Kafka #Message-Broker

### # 9개 프로젝트로 경험하는 대용량 트래픽 & 데이터 처리 초격차 패키지 Online - 패스트 캠퍼스

#### Kafka Basic
##### Overview
* Distributed ~~Message~~/Event Broker
* Pub/Sub, Multiple Read
* Partition, Replica
* Components
	* Producer : Key (for Partition)
	* Consumer/Consumer Group : Offset, Lag, Commit, Pull (backpresure)
	* Topic : Partition by Key (Shard)
	* Broker
		* Server Process
		* Partition Leader/Follower, Controller (leader election)
		* In Sync Replica (by Commit Lag of Follower, Candidate Leader Group)
	* Zookeeper
		* Metadata
		* Offset/Partition Leader
##### vs RabbitMQ

|              | RabbitMQ                                                         | Kafka                                             |
| ------------ | ---------------------------------------------------------------- | ------------------------------------------------- |
| Mesage Florw | Producer<br>-> Exchange -> Binding Rules -> Queue<br>-> Consumer | Producer<br>-> Broker -> Partition<br>-> Consumer |
|              | Easy, Flexible                                                   | Large Throughput, Scaling, Reliability            |
| Message      | Push                                                             | Pull                                              |
| Throughput   | 10k/sec                                                          | 1 million/sec                                     |
|              | Transactional                                                    | Operational                                       |

#### Kafka Setup

```bash
apt-get install default-jre # Java 11
vi ~/.bashrc
# export JAVA_HOME="..."

mkdir kafka && cd kafka
curl "https://archive.apahge.org/dist/kafka/2.7.2/kafka_2.12-2.7.2.tgz" -o kafka.tgz
tar -xvzf kafka.tgz --strip 1

vi confi/server.properties
# advertised.listeners=PLAINTEXT://<public-ip>:9092
# log.dirs=~/kafka/logs

~/kafka/bin/kafka-server-start.sh
# server.peoperties
# KAFKA_LOG4J_OPTS="...=file:$base_dir/../config/log4j.properties"
# KAFKA_HEAP_OPS="-Xmx1G -Xms1G"

vi /etc/systemd/zookeeper.service
# [Unit]
# Requires=...
# After=...
# [Service]
# Type=...
# User=...
# ExecStart=...
# ExecStop=...
# [Install]
# ...

vi /etc/systemd/kafka.service
# ...
```