#Microservice #Monolithic

### Architecture Pattern
#### Monolithic

* Single Process / RDB for Multiple Services
* ==On-Premise (H/W Utilization)==
* Availability (All or Nothing)
* More Coupling, Complexity, Communication Cost
#### Service Oriented Architecture

* ==Multiple Process== / Single RBD for Multiple Services
* Enterprise Service Bus (RPC of Language, Smart Pipe, Monolith)
* Coupling, Complexity
	* Distributed Transaction
	* Performance (Latency, Memory vs Network)
#### Micro Service Architecture

* Process / Database for Each Services
* Virtualization
	* On-Demand, Cloud (Computing / Storage / Network)
	* Container (Lightweight, Portability???)
* ==Agility==, Scalability (Elastic, Scale Out, Distributed)
* Conway's Law, Data Coupling, More Complexity, DevOps
### What is Services?

* Provide Features for Specific Domains (Non-Overlapped in System)
* Expose API called via Network
* Self-Contained (Independently Updated and Released)
#### How to Detect?
* ==Have Only One Reason to Change==  (Single Responsibility)
* Domain-Driven Design
	* Use Business-Meaning Terminology
		* Domain : Problem Space
		* Domain Model : Relationship between Domain Objects
	* Bounded Context
		* Actor Base : Customer, Seller, Admin, ...
	* Sub-domain
		* Split Bounded Context : Order, Payment, Product Recommend
#### References

>applications are split into discrete units of functionality that provide a specific set of functionality. These services provide interfaces for communicating with other services over a network, and their combined functionality is what creates the complete application.
>[What is a microservice architecture, and where did the concept originate?](https://www.gremlin.com/blog/what-is-a-service)

>A service has four properties according to one of many definitions of SOA
>1. It logically represents a repeatable business activity with a specified outcome.
>2. It is self-contained.
>3. It is a black box for its consumers, meaning the consumer does not have to be aware of the service's inner workings.
>4. It may be composed of other services.
>[Service-oriented architecture](https://en.wikipedia.org/wiki/Service-oriented_architecture)
### MSA - Principles

* Organized around Business Capabilities
* Products not Projects
	* Development + Maintain
* Design for Failure
	* Detect, Self Healing, Eventually Consistency, Decoupling
* ~~Smart endpoints~~ and dumb pipes (~~ESB~~)
  Decentralized Data Management / Governance (~~Single RDB~~)
  Infrastructure Automation (~~On-Premise~~)
  Evolutionary Design
#### Assessment
* When Change Code
	* High Communication Cost
	* Delayed Release
	* Hard to Detect Dependencies and that occured Incidents
	* Common Code Change is Too Hard
	* Database Impact to All Other Services
	* ==Hard to Change Code and Release by Dependencies==
* Do you have
	* Engineer of DevOps, Cloud, Monitoring(Distibuted), Open Source
### MSA - Pattern

* 분해
	* Fault Isolation / Release Cycle / Organization
	* Business Ability
		* More Coupling, Dependencies
	* Sub-Domain (DDD)
		* Independent, Low Dependencies
		* Complexity(Too Small), Latency
* Communication
	* Sync : Http, gRPC
	* Async : Messaging, Polling
* Transaction
	* 2 Phase Commit (Loss Rollback)
	* Compensating Transactions
	* Saga Pattern : Cordinator (Orchestration)
* Data Query
	* API Aggregation
		* Computing When Read
		* Small Write + Many Read (Computing)
		* API Gateway, GraphQL
	* CQRS (Command and Query Responsability Seperation)
		* Computing When Write
		* Small Read + Many Write (Storage)
		* De-nomalizated Readonly Database
* Observability (Visiability)
	* Metric / Log / Trace
### MSA - Components
#### API Gateway
* Facade, Single API Endpoint for Client
* Common Features
	* Auth / Security
	* Routing / Throttling
	* Aggregation
	* Formatting, Logging, ...
* BFF (Client Specific API Gateway, Web / Mobile / IoT)
#### Service Mesh
#### Consistency
* Write - Transaction in Distributed Database
	* Multiple Short / ~~Single Long~~
	* Compensating Transaction
* Read - Multiple Source of Truth
#### Pipeline
#### Monitoring
* Metric / Log / Tracing
* Direction
	* Pull : Default
	* Push : Short Time Job, Firewall
### Hexagonal

* In / Out + Port / Adapter
* project
	* domain-service
		* adapter
			* in
				* web
			* out
				* persistence
		* application
			* port
				* in
				* out
			* service
		* domain
	* common
		* WebAdapter
		* PersistenceAdapter
		* UserCase
		* SelfValidating