# 머리말

* 분산 시스템 엔지니어 팀
* 적절한 완성도와 유창하게 확대하거나 축소할 수 있는 시스템
* 견고하고 확장 가능한 시스템 수요 증가
	* 수억 명의 사용자, 매일 수십억 건의 요청량
	* 로깅, 모니터링, 경보

# 1부

## 시스템 설계 개념 둘러보기

### 시스템 설계 면접

* 네트워크를 통해 제공되는 시스템
* 단순 문장 요구사항
* 면접자/면접관 모두 경력에 도움이 됨
* 완벽함 대신 타협
	* 학문적으로 엄밀하거나 과학적이지 않음
	* 주어진 리소스와 시간 안에서 현재와 미래의 요구사항을 가장 잘 만족하는 시스템 설계
	* 트레이드 오프, 타협
* 정답 대신
	* 여러 가능한 접근 방식 논의
	* 트레이드 오프 평가 능력

### 시스템 설계 토론

* 요구사항 인터뷰, 발굴
* 트레이드오프 vs 이점
* 정량 보단 정성

### 시스템의 다양한 서비스 확장 방식

* 서비스에 확장성을 추가하는 일반적인 접근 방식
* 확장성(scalability)
	* 리소스를 투입하여 시스템의 성능을 증가시킬 수 있는 특성
	* 부하에 따라 리소스를 쉽고 비용 효율적으로 조정 할 수 있는 능력
* 샘플 시스템 : Beigel
	* 사용자 근처 베이글 카페에 대한 게시물을 읽고 작성할 수 있는 소비자 대상 앱
* 앱의 소규모 초기 배포
	* 적은 사용자 수와 요청 빈도
	* 단일 호스트, 필요 시 프론트엔드 호스트
	* 브라우저 앱 (React.JS. Brotlli 압축 vs Gzip), iOS 앱, Android 앱
	* Stateless Go or Java 백엔드, 프론트엔드 (for 브라우저 앱)
	* Stand alone SQL 데이터베이스
* GeoDNS 확장
	* 아시아, 유럽, 북미에서 수십만 DAU (하루 동안의 고유 사용자 수)
	* 백엔드 서비스 요청 : 초당 수천 건
	* 모니터링 상 504 응답 증가
	* 지역 데이터 센터 별 Stateless 백엔드 호스트 배포
	* GeoDNS를 사용해 클라이언트를 가장 가까운 데이터 센터로 라우팅
		* 클라이언트 IP 기반 위치 정보 유추
		* 도메인에 여러 위치와 여러 A 레코드의 기본 IP 주소를 할당
		* A 레코드 : 도메인을 IP 주소에 매핑하는 DNS 구성
		* DNS 레코드는 ISP, OS, 브라우저 등에서 캐시 됨
* 캐싱 서비스 추가
	* 레디스 캐시 서비스 추가
	* 트래픽이 많은 특정 백엔드 엔드포인트를 캐시로 제공
	* 이후의 확장을 위해 추가 단계 필요
* CDN
	* 프론트엔드의 정적 컨텐츠 호스팅을 위해 CDN 추가
		* 지연 시간, 처리량, 신뢰성, 비용 개선
		* 유지보수, 통합 부담, 고객지원으로 단위 비용 감소
		* CloudFlare, AWS CloudFront
	* CDN 용량 설정, 파일 업로드, CDN URL 기반으로 코드 수정
	* CDN은 전세계 데이터 센터에 정적 파일 복사본 유지
	* CDN을 통해 낮은 지연시간으로 정적 컨텐츠 제공 가능
* Scale-Out과 Cluster, CI/CD
	* DevOps를 통한 대규모 클러스터 인프라 관리
	* 확장 요구에 맞게 빠른 클러스터 규모 조정
	* 신규 호스트의 구성 관리, 빌드, 배포
	* 개발, 릴리즈 프로세스 개선
	* IaC
		* Jenkins, Docker, Kubernetes/Docker Swarm
		* Ansible, Terraform (DSL)
	* 점진적 Roll-Out, Roll-Back
		* 점진적 배포. 특정 비율의 호스트 배포 (1, 5, 10, 25, 50, 75, 100%)
		* 테스트 누락 버그, 충돌, 지연 증가, 메모리 누수, 리소스 사용량 증가, 사용자 이탈
		* 기준 지연 시간을 설정하고, 신규 인스턴스에서 기존 인트턴스 or 캐시로 데이터 응답
	* 실험
		* 모든 사용자 일괄적용 대신, 점진적으로 사용자 비율 증가
		* UX 변경이 사용자 행동에 미치는 영향 파악
		* A/B 테스트, 멀티암드 밴딧, 다변량 테스트
		* 실험은 기능의 토글/개인화로 비율 변경, 점진적 배포는 CD 도구에서 수행
		* 실험 대상 앱은 기능이 많아 크기가 크다
* 기능적 분할과 시스템 레벨 AOP
	* 공통 관심사의 공유 서비스 분리
	* 공유 서비스
		* 수백만 DAU, 대규모 개발팀 (iOS 5명, Android 5명, 프론트 10명, 백엔드 100명, 데이터 사이언스 팀)
		* 고객 지원, 운영 부서를 위한 백오피스